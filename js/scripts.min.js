!function(){var t=t||{};t.cat=function(t,e){var n,i=this._terminal.parseArgs(t).filenames;return this._terminal.scroll(),i.length?(i.forEach(function(t,e){var n=this._terminal.getEntry(t);this._terminal.write(n?"dir"===n.type?"cat: "+t+": Is a directory.":n.contents:"cat: "+t+": No such file or directory"),e!==i.length-1&&this._terminal.write("<br>")},this),void e()):void(this._terminal.returnHandler=function(){n=this.stdout(),n&&(n.innerHTML+="<br>"+n.innerHTML+"<br>",this.scroll(),this.newStdout())}.bind(this._terminal))},t.cd=function(t,e){var n,i=this._terminal.parseArgs(t).filenames[0];i||(i="~"),n=this._terminal.getEntry(i),n?"dir"!==n.type?this._terminal.write("bash: cd: "+i+": Not a directory."):this._terminal.cwd=n:this._terminal.write("bash: cd: "+i+": No such file or directory"),e()},t.ls=function(t,e){var n,i=this._terminal.parseArgs(t),r=i.args,s=i.filenames[0],a=s?this._terminal.getEntry(s):this._terminal.cwd,o=0;if(n=function(t,e){this.writeLink(t,e),r.indexOf("l")>-1?("description"in t&&this.write(" - "+t.description),this.write("<br>")):this.write(Array(o-t.name.length+2).join("&nbsp")+" ")}.bind(this._terminal),a)if("dir"===a.type){var h=this._terminal.dirString(a);o=a.contents.reduce(function(t,e){return Math.max(t,e.name.length)},0);for(var l in a.contents){var c=a.contents[l];(r.indexOf("a")>-1||"."!==c.name[0])&&n(c,h+"/"+c.name)}}else o=a.name.length,n(a,s);else this._terminal.write("ls: cannot access "+s+": No such file or directory");e()},t.gimp=function(t,e){var n,i,r=this._terminal.parseArgs(t).filenames[0];return r?(n=this._terminal.getEntry(r),n&&"img"===n.type?(this._terminal.write('<img src="'+n.contents+'"/>'),i=this._terminal.div.getElementsByTagName("img"),i[i.length-1].onload=function(){this.scroll()}.bind(this._terminal),"caption"in n&&this._terminal.write("<br/>"+n.caption)):this._terminal.write("gimp: file "+r+" is not an image file."),void e()):(this._terminal.write("gimp: please specify an image file."),void e())},t.clear=function(t,e){this._terminal.div.innerHTML="",e()},t.sudo=function(t,e){var n=0;this._terminal.returnHandler=function(){++n<3?(this.write("<br/>Sorry, try again.<br/>"),this.write("[sudo] password for "+this.config.username+": "),this.scroll()):(this.write("<br/>sudo: 3 incorrect password attempts"),e())}.bind(this._terminal),this._terminal.write("[sudo] password for "+this._terminal.config.username+": "),this._terminal.scroll()},t.login=function(t,e){this._terminal.returnHandler=function(){var t=this.stdout().innerHTML;this.scroll(),t&&(this.config.username=t),this.write("<br>Password: "),this.scroll(),this.returnHandler=function(){e()}}.bind(this._terminal),this._terminal.write("Username: "),this._terminal.newStdout(),this._terminal.scroll()},t.tree=function(t,e){function n(t,e){t.contents.forEach(function(i){var s="";if(!i.name.startswith(".")){for(var a=0;e>a;a++)s+="|  ";s+="|&mdash;&mdash;",r.write(s),r.writeLink(i,r.dirString(t)+"/"+i.name),r.write("<br>"),"dir"===i.type&&n(i,e+1)}})}var i,r=this._terminal;i=this._terminal.getEntry("~"),this._terminal.writeLink(i,"~"),this._terminal.write("<br>"),n(i,0),e()},t.help=function(t,e){this._terminal.write('You can navigate either by clicking on anything that <a href="javascript:void(0)">underlines</a> when you put your mouse over it, or by typing commands in the terminal. Type the name of a <span class="exec">link</span> to view it. Use "cd" to change into a <span class="dir">directory</span>, or use "ls" to list the contents of that directory. The contents of a <span class="text">file</span> can be viewed using "cat". <span class="img">Images</span> are displayed using "gimp".<br><br>If there is a command you want to get out of, press Ctrl+C or Ctrl+D.<br><br>'),this._terminal.write("Commands are:<br>");for(var n in this._terminal.commands)this._terminal.commands.hasOwnProperty(n)&&!n.startswith("_")&&this._terminal.write(n+"  ");e()};var e=e||{};e.prompt=function(t,e){return e?'<span class="user">'+e+'</span>@<span class="host">shafeeqonline.com</span>:<span class="cwd">'+t+"</span>$ ":"TerminalSite 1.0 $ "},e.username="";var n=function(t,e){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&e(n.responseText)},n.open("GET",t),n.send()},i={init:function(t,e,n,i){this._queue=[],this._history=[],this._historyIndex=-1,this.loadConfig(t),n&&this.loadCommands(n),e?this.loadFS(e,i):i&&i()},loadFS:function(t,e){n(t,function(t){this.fs=JSON.parse(t),this._addDirs(this.fs,this.fs),e()}.bind(this))},loadCommands:function(t){this.commands=t,this.commands._terminal=this},loadConfig:function(t){this.config=t},begin:function(t){var e=t||document.body;this.div=document.createElement("div"),this.div.classList.add("terminalholder"),e.appendChild(this.div),window.onkeydown=function(t){var e=t.which?t.which:t.keyCode;(8==e||9==e||13==e||46==e||38==e||40==e||t.ctrlKey)&&t.preventDefault(),this._handleSpecialKey(e,t)}.bind(this),window.onkeypress=function(t){this._typeKey(t.which?t.which:t.keyCode)}.bind(this),this.returnHandler=this._execute,this.cwd=this.fs,this._prompt(),this._toggleBlinker(400),this._dequeue()},getCWD:function(){return this.dirString(this.cwd)},dirString:function(t){for(var e=t,n="";this._dirNamed("..",e.contents).contents!==e.contents;)n="/"+e.name+n,e=this._dirNamed("..",e.contents);return"~"+n},getEntry:function(t){var e,n;if(!t)return null;if(t=t.replace(/^\s+/,"").replace(/\s+$/,""),!t.length)return null;e=this.cwd,"~"==t[0]&&(e=this.fs,t=t.substring(1,t.length)),n=t.split("/").filter(function(t){return t});for(var i=0;i<n.length;++i)if(e=this._dirNamed(n[i],e.contents),!e)return null;return e},write:function(t){var e=this.stdout();e&&(e.innerHTML+=t)},defaultReturnHandler:function(){this.returnHandler=this._execute},typeCommand:function(t,e){var n=this;!function i(r){r==t.length?(n._handleSpecialKey(13),e&&e()):(n._typeKey(t.charCodeAt(r)),setTimeout(function(){i(r+1)},100))}(0)},tabComplete:function(t){var e=t.replace(/^\s+/,"").split(" "),n=[];if(!e.length)return[];if(1==e.length){var i,r,s,a,o=e[0].replace(/[\/]+/,"/").split("/"),s=o.pop(),a=o.length>0?this.getEntry(o.join("/")):this.cwd;if(a)for(var h in a.contents)i=a.contents[h].name,i.startswith(s)&&!i.startswith(".")&&i!=s&&"exec"==a.contents[h].type&&n.push(i+" ");for(var l in this.commands)"_"!=l[0]&&l.startswith(e[0])&&l!=e[0]&&n.push(l+" ")}else{if(r=e[e.length-1],o=r.replace(/[\/]+/,"/").split("/"),s=o.pop(),a=o.length>0?this.getEntry(o.join("/")):this.cwd,!a)return[];for(var h in a.contents)i=a.contents[h].name,i.startswith(s)&&!i.startswith(".")&&i!=s&&n.push("dir"==a.contents[h].type?i+"/":i+" ")}return n},enqueue:function(t){return this._queue.push(t),this},scroll:function(){window.scrollBy(0,document.body.scrollHeight)},parseArgs:function(t){for(var e,n=[],i=[],r=0;r<t.length;++r)if(t[r].startswith("-")){e=t[r].substring(1);for(var s=0;s<e.length;++s)n.push(e.charAt(s))}else i.push(t[r]);return{filenames:i,args:n}},writeLink:function(t,e){this.write('<span class="'+t.type+'">'+this._createLink(t,e)+"</span>")},stdout:function(){return this.div.querySelector("#stdout")},newStdout:function(){var t=this.stdout(),e=document.createElement("span");this._resetID("#stdout"),e.id="stdout",t.parentNode.insertBefore(e,t.nextSibling)},_createLink:function(t,e){function n(t,e){return'<a href="javascript:void(0)" onclick="typeCommand(\''+t+"')\">"+e+"</a>"}return"dir"==t.type||"link"==t.type?n("ls -l "+e,t.name):"text"==t.type?n("cat "+e,t.name):"img"==t.type?n("gimp "+e,t.name):"exec"==t.type?'<a href="'+t.contents+'" target="_blank">'+t.name+"</a>":void 0},_dequeue:function(){this._queue.length&&this.typeCommand(this._queue.shift(),function(){this._dequeue()}.bind(this))},_dirNamed:function(t,e){for(var n in e)if(e[n].name==t)return"link"==e[n].type?e[n].contents:e[n];return null},_addDirs:function(t,e){t.contents.forEach(function(e){"dir"==e.type&&this._addDirs(e,t)}.bind(this)),t.contents.unshift({name:"..",type:"link",contents:e}),t.contents.unshift({name:".",type:"link",contents:t})},_toggleBlinker:function(t){var e,n=this.div.querySelector("#blinker");n?n.parentNode.removeChild(n):(e=this.stdout(),e&&(n=document.createElement("span"),n.id="blinker",n.innerHTML="&#x2588",e.parentNode.appendChild(n))),t&&setTimeout(function(){this._toggleBlinker(t)}.bind(this),t)},_resetID:function(t){var e=this.div.querySelector(t);e&&e.removeAttribute("id")},_prompt:function(){var t=document.createElement("div"),e=document.createElement("span"),n=document.createElement("span");this._resetID("#currentPrompt"),this.div.appendChild(t),e.id="currentPrompt",e.innerHTML=this.config.prompt(this.getCWD(),this.config.username),t.appendChild(e),this._resetID("#stdout"),n.id="stdout",t.appendChild(n),this._toggleBlinker(0),this.scroll()},_typeKey:function(t){var e=this.stdout();!e||32>t||t>126||13==t||9==t||(e.innerHTML+=String.fromCharCode(t))},_handleSpecialKey:function(t,e){var n,i,r=this.stdout();if(r)if(8==t||46==t)r.innerHTML=r.innerHTML.replace(/.$/,"");else if(13==t)this.returnHandler(r.innerHTML);else if(38==t)this._historyIndex<this._history.length-1&&(r.innerHTML=this._history[++this._historyIndex]);else if(40==t)this._historyIndex<=0?(0==this._historyIndex&&this._historyIndex--,r.innerHTML=""):this._history.length&&(r.innerHTML=this._history[--this._historyIndex]);else if(9==t)matches=this.tabComplete(r.innerHTML),matches.length&&(n=r.innerHTML.split(" "),i=n[n.length-1].split("/"),i[i.length-1]=matches[0],n[n.length-1]=i.join("/"),r.innerHTML=n.join(" "));else if(67!=t&&68!=t||!e.ctrlKey){if(76==t&&e.ctrlKey){var s=r.innerHTML;this.commands.clear([],function(){this._prompt(),r.innerHTML=s}.bind(this))}}else 67==t&&this.write("^C"),this.defaultReturnHandler(),this._prompt()},_execute:function(t){var e=document.createElement("div"),n=document.createElement("span"),i=t.split(" ").filter(function(t){return t}),r=i[0],s=i.slice(1,i.length),a=this.getEntry(t);this._resetID("#stdout"),n.id="stdout",e.appendChild(n),this.div.appendChild(e),r&&r.length?r in this.commands?this.commands[r](s,function(){this.defaultReturnHandler(),this._prompt()}.bind(this)):a&&"exec"==a.type?(window.open(a.contents,"_blank"),this._prompt()):(this.write(r+": command not found"),this._prompt()):this._prompt(),t.length&&this._history.unshift(t),this._historyIndex=-1}};String.prototype.startswith=function(t){return 0==this.indexOf(t)},i.init(e,"/json/sample.json",t,function(){i.enqueue("login").enqueue("shafeeq").enqueue("******").enqueue("cat README").enqueue("help").enqueue("cd projects").enqueue("ls -l").enqueue("cd ..").enqueue("tree").enqueue("ls"),setTimeout(function(){document.body.innerHTML=""},2e3),setTimeout(function(){i.begin()},3e3)}),window.typeCommand=function(t){i.typeCommand(t)}}();