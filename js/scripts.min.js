!function(){var t=t||{};t.cat=function(t,n){var e,i=this._terminal.parseArgs(t).filenames;return this._terminal.scroll(),i.length?(i.forEach(function(t,n){var e=this._terminal.getEntry(t);this._terminal.write(e.contents),n!==i.length-1&&this._terminal.write("<br>")},this),void n()):void(this._terminal.returnHandler=function(){e=this.stdout(),e&&(e.innerHTML+="<br>"+e.innerHTML+"<br>",this.scroll(),this.newStdout())}.bind(this._terminal))},t.cd=function(t,n){var e,i=this._terminal.parseArgs(t).filenames[0];i||(i="~"),e=this._terminal.getEntry(i),this._terminal.cwd=e,n()},t.ls=function(t,n){var e,i=this._terminal.parseArgs(t),s=i.args,r=i.filenames[0],a=r?this._terminal.getEntry(r):this._terminal.cwd,o=0;if(e=function(t,n){this.writeLink(t,n),s.indexOf("l")>-1?("description"in t&&this.write(" - "+t.description),this.write("<br>")):this.write(Array(o-t.name.length+2).join("&nbsp")+" ")}.bind(this._terminal),"dir"===a.type){var h=this._terminal.dirString(a);o=a.contents.reduce(function(t,n){return Math.max(t,n.name.length)},0);for(var c in a.contents){var u=a.contents[c];(s.indexOf("a")>-1||"."!==u.name[0])&&e(u,h+"/"+u.name)}}else o=a.name.length,e(a,r);n()},t.gimp=function(t,n){var e,i,s=this._terminal.parseArgs(t).filenames[0];return s?(e=this._terminal.getEntry(s),e&&"img"===e.type?(this._terminal.write('<img src="'+e.contents+'"/>'),i=this._terminal.div.getElementsByTagName("img"),i[i.length-1].onload=function(){this.scroll()}.bind(this._terminal),"caption"in e&&this._terminal.write("<br/>"+e.caption)):this._terminal.write("gimp: file "+s+" is not an image file."),void n()):(this._terminal.write("gimp: please specify an image file."),void n())},t.clear=function(t,n){this._terminal.div.innerHTML="",n()},t.sudo=function(t,n){var e=0;this._terminal.returnHandler=function(){++e<3?(this.write("<br/>Sorry, try again.<br/>"),this.write("[sudo] password for "+this.config.username+": "),this.scroll()):(this.write("<br/>sudo: 3 incorrect password attempts"),n())}.bind(this._terminal),this._terminal.write("[sudo] password for "+this._terminal.config.username+": "),this._terminal.scroll()},t.login=function(t,n){this._terminal.returnHandler=function(){var t=this.stdout().innerHTML;this.scroll(),t&&(this.config.username=t),this.write("<br>Password: "),this.scroll(),this.returnHandler=function(){n()}}.bind(this._terminal),this._terminal.write("Username: "),this._terminal.newStdout(),this._terminal.scroll()},t.tree=function(t,n){function e(t,n){t.contents.forEach(function(i){var r="";if(!i.name.startswith(".")){for(var a=0;n>a;a++)r+="|  ";r+="|&mdash;&mdash;",s.write(r),s.writeLink(i,s.dirString(t)+"/"+i.name),s.write("<br>"),"dir"===i.type&&e(i,n+1)}})}var i,s=this._terminal;i=this._terminal.getEntry("~"),this._terminal.writeLink(i,"~"),this._terminal.write("<br>"),e(i,0),n()},t.help=function(t,n){this._terminal.write('You can navigate either by clicking on anything that <a href="javascript:void(0)">underlines</a> when you put your mouse over it, or by typing commands in the terminal. Type the name of a <span class="exec">link</span> to view it. Use "cd" to change into a <span class="dir">directory</span>, or use "ls" to list the contents of that directory. The contents of a <span class="text">file</span> can be viewed using "cat". <span class="img">Images</span> are displayed using "gimp".<br>'),this._terminal.write("Commands are:<br>");for(var e in this._terminal.commands)this._terminal.commands.hasOwnProperty(e)&&!e.startswith("_")&&this._terminal.write(e+"  ");n()};var n=n||{};n.prompt=function(t,n){return n?'<span class="user">'+n+'</span>@<span class="host">shafeeqonline.com</span>:<span class="cwd">'+t+"</span>$ ":"TerminalSite 1.0 $ "},n.username="";var e=function(t,n){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&200==e.status&&n(e.responseText)},e.open("GET",t),e.send()},i={init:function(t,n,e,i){this._queue=[],this._history=[],this._historyIndex=-1,this.loadConfig(t),e&&this.loadCommands(e),n?this.loadFS(n,i):i&&i()},loadFS:function(t,n){e(t,function(t){this.fs=JSON.parse(t),this._addDirs(this.fs,this.fs),n()}.bind(this))},loadCommands:function(t){this.commands=t,this.commands._terminal=this},loadConfig:function(t){this.config=t},begin:function(t){var n=t||document.body;this.div=document.createElement("div"),this.div.classList.add("jsterm"),n.appendChild(this.div),window.onkeydown=function(t){var n=t.which?t.which:t.keyCode;13==n&&t.preventDefault(),this._handleSpecialKey(n,t)}.bind(this),window.onkeypress=function(t){this._typeKey(t.which?t.which:t.keyCode)}.bind(this),this.returnHandler=this._execute,this.cwd=this.fs,this._prompt(),this._dequeue()},getCWD:function(){return this.dirString(this.cwd)},dirString:function(t){for(var n=t,e="";this._dirNamed("..",n.contents).contents!==n.contents;)e="/"+n.name+e,n=this._dirNamed("..",n.contents);return"~"+e},getEntry:function(t){var n,e;if(!t)return null;if(t=t.replace(/^\s+/,"").replace(/\s+$/,""),!t.length)return null;n=this.cwd,"~"==t[0]&&(n=this.fs,t=t.substring(1,t.length)),e=t.split("/").filter(function(t){return t});for(var i=0;i<e.length;++i)if(n=this._dirNamed(e[i],n.contents),!n)return null;return n},write:function(t){var n=this.stdout();n&&(n.innerHTML+=t)},defaultReturnHandler:function(){this.returnHandler=this._execute},typeCommand:function(t,n){var e=this;!function i(s){s==t.length?(e._handleSpecialKey(13),n&&n()):(e._typeKey(t.charCodeAt(s)),setTimeout(function(){i(s+1)},100))}(0)},enqueue:function(t){return this._queue.push(t),this},scroll:function(){},parseArgs:function(t){for(var n,e=[],i=[],s=0;s<t.length;++s)if(t[s].startswith("-")){n=t[s].substring(1);for(var r=0;r<n.length;++r)e.push(n.charAt(r))}else i.push(t[s]);return{filenames:i,args:e}},writeLink:function(t,n){this.write('<span class="'+t.type+'">'+this._createLink(t,n)+"</span>")},stdout:function(){return this.div.querySelector("#stdout")},newStdout:function(){var t=this.stdout(),n=document.createElement("span");this._resetID("#stdout"),n.id="stdout",t.parentNode.insertBefore(n,t.nextSibling)},_createLink:function(t,n){function e(t,n){return'<a href="javascript:void(0)" onclick="typeCommand(\''+t+"')\">"+n+"</a>"}return"dir"==t.type||"link"==t.type?e("ls -l "+n,t.name):"text"==t.type?e("cat "+n,t.name):"img"==t.type?e("gimp "+n,t.name):"exec"==t.type?'<a href="'+t.contents+'" target="_blank">'+t.name+"</a>":void 0},_dequeue:function(){this._queue.length&&this.typeCommand(this._queue.shift(),function(){this._dequeue()}.bind(this))},_dirNamed:function(t,n){for(var e in n)if(n[e].name==t)return"link"==n[e].type?n[e].contents:n[e];return null},_addDirs:function(t,n){t.contents.forEach(function(n){"dir"==n.type&&this._addDirs(n,t)}.bind(this)),t.contents.unshift({name:"..",type:"link",contents:n}),t.contents.unshift({name:".",type:"link",contents:t})},_resetID:function(t){var n=this.div.querySelector(t);n&&n.removeAttribute("id")},_prompt:function(){var t=document.createElement("div"),n=document.createElement("span"),e=document.createElement("span");this._resetID("#currentPrompt"),this.div.appendChild(t),n.classList.add("prompt"),n.id="currentPrompt",n.innerHTML=this.config.prompt(this.getCWD(),this.config.username),t.appendChild(n),this._resetID("#stdout"),e.classList.add("command"),e.id="stdout",t.appendChild(e),this.scroll()},_typeKey:function(t){var n=this.stdout();!n||32>t||t>126||13==t||9==t||(n.innerHTML+=String.fromCharCode(t))},_handleSpecialKey:function(t){var n=this.stdout();n&&13==t&&this.returnHandler(n.innerHTML)},_execute:function(t){var n=document.createElement("div"),e=document.createElement("span"),i=t.split(" ").filter(function(t){return t}),s=i[0],r=i.slice(1,i.length),a=this.getEntry(t);this._resetID("#stdout"),e.id="stdout",n.appendChild(e),this.div.appendChild(n),s&&s.length?s in this.commands?this.commands[s](r,function(){this.defaultReturnHandler(),this._prompt()}.bind(this)):a&&"exec"==a.type?(window.open(a.contents,"_blank"),this._prompt()):(this.write(s+": command not found"),this._prompt()):this._prompt(),t.length&&this._history.unshift(t),this._historyIndex=-1}};String.prototype.startswith=function(t){return 0==this.indexOf(t)},i.init(n,"/json/sample.json",t,function(){i.enqueue("login").enqueue("shafeeq").enqueue("******").enqueue("cat README").enqueue("help").enqueue("cd projects").enqueue("ls -l").enqueue("cd ..").enqueue("tree").enqueue("ls").begin()}),window.typeCommand=function(t){i.typeCommand(t)}}();